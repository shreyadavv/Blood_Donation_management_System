{% extends 'base.html' %}
{% block content %}
<h3 class="mb-3">Admin Dashboard</h3>

{% if not authorized %}
  <form method="post" class="row g-3" action="{{ url_for('admin') }}">
    <div class="col-md-4">
      <label class="form-label">Admin Key</label>
      <input type="password" name="key" class="form-control" required>
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button class="btn btn-danger w-100">Enter</button>
    </div>
  </form>
  <p class="text-muted mt-3">Tip: Update the key in <code>app.py</code> (variable <code>ADMIN_KEY</code>).</p>
{% else %}
  <div class="mb-4">
    <h5>Registered Donors</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Blood Group</th>
            <th>Contact</th>
            <th>Location</th>
            <th>Last Donated</th>
          </tr>
        </thead>
        <tbody>
        {% for d in donors %}
          <tr>
            <td>{{ d.id }}</td>
            <td>{{ d.name }}</td>
            <td>{{ d.age }}</td>
            <td>{{ d.gender }}</td>
            <td><span class="badge bg-danger">{{ d.blood_group }}</span></td>
            <td>{{ d.contact }}</td>
            <td>{{ d.location }}</td>
            <td>{{ d.last_donated or '-' }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div>
    <h5>Incoming Requests</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Blood Group</th>
            <th>Contact</th>
            <th>Location</th>
            <th>Urgency</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
        {% for r in reqs %}
          <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.name }}</td>
            <td><span class="badge bg-danger">{{ r.blood_group }}</span></td>
            <td>{{ r.contact }}</td>
            <td>{{ r.location }}</td>
            <td>{{ r.urgency or 'Normal' }}</td>
            <td>{{ r.note or '-' }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}
{% endblock %}